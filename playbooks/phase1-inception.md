# Phase 1: Inception プレイブック

> 人間の漠然としたアイデアを、実行可能な要件に変換する

## 前提条件

- `aidlc-docs/aidlc-state.md` が存在すること
- `aidlc-docs/audit.md` が存在すること

---

## Step 1: Intent（意図の表明）

### AIの行動

1. **ユーザーの意図を受け取る**
   - 人間に「何を作りたいですか？自由に話してください」と問いかける
   - 既にドキュメント（PRD・メモ等）がある場合は「既存の資料があれば共有してください」と伝える

2. **課題と解決策を分離する（XY問題の検出）**
   - ユーザーの発言が「課題（困っていること）」か「解決策（作りたいもの）」かを判別する
   - 解決策の形で語られている場合（「○○機能が欲しい」「○○を作りたい」）、背景にある課題を確認する:
     - 「それがあると何が解決しますか？」
     - 「今はどうやっていて、何が困っていますか？」
   - 課題を特定した上で、ユーザーが提示した解決策が最適かを検証する:
     - 「その課題であれば○○という方法もありますが、△△にこだわる理由はありますか？」

3. **課題を深掘りする**
   - 以下の観点で深掘り質問をする:
     - **Why**: なぜそれが問題なのか？どんな問題を解決するのか？
     - **Who**: 誰のためのものか？ターゲットユーザーは？
     - **What**: 具体的にどんなことができるべきか？
     - **How much**: 成功をどう測るか？KPIは？
   - **Why の深掘りルール**:
     - 最低2段階の掘り下げを行う
     - 1段目: 「なぜそれが問題なのか？」→ 現状のペインを特定
     - 2段目: 「その問題が解決されないと、具体的に何が起きるか？」→ 影響範囲と深刻度を把握
     - 回答が「具体的なシーン・数値・頻度」を含むレベルに達するまで掘る
     - 抽象的な回答（「不便」「非効率」）で止めない。「具体的なエピソードを1つ聞かせてください」のように自然に掘る
     - Why が具体化されてから次の観点に進む

4. **仮説を提示して確認する**
   - 人間の回答をもとに、AIが仮説を立てて提示する
   - 「こういう理解で合っていますか？」と確認する
   - 曖昧な部分は選択肢を提示して人間に選ばせる

5. **制約・前提条件を聞く**
   - 技術的制約（既存システムとの統合など）
   - ビジネス上の制約（期限、予算など）
   - チーム・リソースの制約

### 対話のルール

- AIは必要な質問を過不足なく行う。Inception は全工程の土台なので、質問数を制限しない
- AIは常に「こう理解しました」と要約してから次に進む
- 人間が曖昧な場合、AIが仮の答えを提案し「これでよいですか？」と聞く
- Why の回答が抽象的な場合、具体化を促してから次の観点に進む

### 成果物の生成

- 対話が十分に行われたら `aidlc-docs/inception/intent.md` を生成する
- テンプレート: `templates/inception/intent.md` を使用
- 生成後、人間に内容を確認してもらう

### 記録

- `aidlc-docs/audit.md` の Phase 1 > Step 1 に対話サマリーを記録する
- 決定事項と生成した成果物を記録する

### 完了条件

- `aidlc-docs/inception/intent.md` が生成され、人間が内容を確認した
- `aidlc-docs/aidlc-state.md` の Step 1 チェックボックスを `[x]` にする

---

## Step 2: Requirements（要件の具体化）

### AIの行動

1. **intent.md を読み込む**
   - Step 1 で生成した `aidlc-docs/inception/intent.md` を読み込む

2. **機能要件を洗い出す**
   - Intent から必要な機能を抽出し一覧化する
   - 各機能に優先度を付ける（Must / Should / Could）
   - 人間に確認: 「この機能一覧で過不足はありますか？」

3. **暗黙の要件をチェックする**
   - 以下のチェックリストを機能要件と突き合わせ、漏れている観点がないか確認する:
     - **認証・認可**: ログインは必要か？ユーザー種別ごとの権限は？
     - **データのライフサイクル**: 作成・読み取り・更新・削除は全て必要か？データの保持期限は？
     - **通知・フィードバック**: 操作結果をどう伝えるか？非同期処理の完了通知は？
     - **エラーハンドリング**: 操作失敗時にユーザーに何を見せるか？
     - **管理機能**: 管理者向けの機能は必要か？
     - **外部連携**: 他サービスとの連携は？データのインポート/エクスポートは？
   - 各カテゴリについて「この観点は必要ですか？」と人間に確認する
   - 明らかに不要なものはAIがスキップしてよい

4. **MVPスコープを定義する**
   - Must の機能を中心にMVPスコープを提案する
   - やること / やらないこと / 将来やるかもしれないこと を明確に分ける
   - 人間に確認: 「MVPとしてはこの範囲でよいですか？」
   - スコープが広がりすぎたら「MVPとしてはここまでにしませんか？」と提案する

5. **非機能要件を定義する**
   - パフォーマンス、セキュリティ、アクセシビリティ、対応環境を確認する
   - 人間に確認が必要なものだけ聞く。明らかなものはAIが埋める

6. **ユーザーストーリーを生成する**
   - 機能要件をユーザーストーリー形式に変換する
   - 各ストーリーに Acceptance Criteria を付ける
   - **ACは以下の3条件をすべて満たすこと:**
     - **具体的か**: 数値・条件・状態が明記されている
     - **検証可能か**: テストで合否を判定できる
     - **一意に解釈できるか**: 読む人によって解釈がブレない
   - NG例: 「レスポンスが速いこと」→ OK例: 「一覧画面の初回表示が2秒以内であること」
   - NG例: 「適切なエラーメッセージを表示すること」→ OK例: 「入力が空の場合、入力欄の下に『この項目は必須です』と赤字で表示すること」
   - AIはACを生成した後、3条件に照らして自己チェックし、満たさないものは書き直す
   - 人間に確認: 「このユーザーストーリーで漏れはありますか？」

7. **異常系・エッジケースを洗い出す**
   - 各ユーザーストーリーに対して「このストーリーが失敗するケースは何か？」を列挙する
   - 主要な異常系パターン:
     - **入力不正**: 空、形式違い、範囲外、長すぎ
     - **リソース不在**: 対象データが存在しない、削除済み
     - **権限不足**: 操作権限がないユーザーがアクセス
     - **状態不整合**: 同時操作、既に処理済みのものを再処理
     - **外部依存の失敗**: API障害、タイムアウト
   - 重要な異常系（ユーザーに影響が大きいもの）は Acceptance Criteria に明記する
   - 軽微なもの（入力バリデーション等）は「AIの裁量で適切にハンドリングする」と記載し、Phase 4 のAIに判断を委ねる

8. **要件間の矛盾を検出・解消する**
   - 生成した要件・ユーザーストーリー全体を通して矛盾・曖昧さを分析する
   - 検出対象: スコープの不一致、優先度の矛盾、前提条件の競合、用語の揺れ
   - 矛盾が見つかった場合は人間に提示し、解消されるまで次に進まない

### 成果物の生成

- `aidlc-docs/inception/requirements.md` を生成する
- `aidlc-docs/inception/user-stories.md` を生成する
- テンプレート: `templates/inception/` を使用

### 記録

- `aidlc-docs/audit.md` の Phase 1 > Step 2 に対話サマリーを記録する

### 完了条件

- `aidlc-docs/inception/requirements.md` と `aidlc-docs/inception/user-stories.md` が生成された
- 人間が内容を確認した
- `aidlc-docs/aidlc-state.md` の Step 2 チェックボックスを `[x]` にする

---

## Step 3: Approval Gate（承認）

> **承認ゲート**: 中間ステップの「確認」と異なり、フェーズ全体の成果物を判断する。承認されれば次フェーズへ進む。

### AIの行動

1. **全成果物を要約して提示する**
   - intent.md、requirements.md、user-stories.md の要点をまとめて提示する
   - 「以上が Phase 1 の成果物です。承認いただけますか？」と問う

2. **人間の判断を受ける**
   - **承認**: Phase 2 に進む
   - **フィードバックあり**: 指摘された箇所を修正し、再度承認を求める

### 記録

- `aidlc-docs/audit.md` の Phase 1 > Step 3 に承認結果を記録する

### 完了条件

- 人間が承認した
- `aidlc-docs/aidlc-state.md` の Step 3 チェックボックスを `[x]` にする
- `aidlc-docs/aidlc-state.md` の `Current Phase` を `Phase 2 - Blueprint` に更新する
